"0","path_data <- ""~/ubuntu_research/Research/adjusted_psi/data/final_data"""
"0","setwd(path_data)"
"0","df3 <- read.csv(""pcr_sens_time_v2.csv"")"
"0","path_code <- ""~/ubuntu_research/Research/adjusted_psi/codes/with_synthetic_data/psi"""
"0","setwd(path_code)"
"0","source(""generation_psi_zero-phi.R"")"
"0","source(""formalism_zero_phi.R"")"
"0",""
"0","# Miscellaneous checks"
"0","results_list <- vector(""list"", nrow(df3))"
"0",""
"0","## changing n"
"0","# df3$n <- 10000"
"0",""
"0","set.seed(123)"
"0","for (i in seq_len(nrow(df3))) {"
"0","  study <- df3[i, ]"
"0","  n <- 10000"
"0","  n_iter_mc <- 10000"
"0","  rho_true <- study$rho_true"
"0","  psi_true <- study$psi_true"
"0",""
"0","  sen_a <- study$alpha_a"
"0","  sen_b <- study$alpha_b"
"0","  spe_a <- study$beta_a"
"0","  spe_b <- study$beta_b"
"0","  "
"0","  # --- 1. Simulate data for this study"
"0","  out_synthetic <- synthetic_zero_phi(n, rho_true, psi_true, sen_a, sen_b, spe_a, spe_b)"
"0","  n_sym_pos <- out_synthetic$n_sym_pos"
"0","  n_asym_pos <- out_synthetic$n_asym_pos"
"0","  n_sym_neg <- out_synthetic$n_sym_neg"
"0","  n_asym_neg <- out_synthetic$n_asym_neg"
"0","  n_total <-  n_sym_pos + n_asym_pos + n_sym_neg + n_asym_neg"
"0","  "
"0","  ## Crude estimates"
"0","  rho_c <- (n_sym_pos + n_asym_pos) / n_total"
"0","  psi_c <- n_asym_pos / (n_sym_pos + n_asym_pos)"
"0",""
"0","  # --- 2. Analytical formalism Monte Carlo ---"
"0","  psi_form <- model_formalism_zero_phi(n, n_sym_pos + n_asym_pos, "
"0","                              n_iter_mc, rho_c, psi_c, sen_a, sen_b, spe_a, spe_b)"
"0","  psi_delta = as.numeric(abs(psi_true - psi_form)*100/psi_true)"
"0","  "
"0","  # Store results in data frame"
"0","  "
"0","  vars <- list("
"0","    n = study$n,"
"0","    "
"0","    psi_form_median = as.numeric(quantile(psi_form, 0.5)),"
"0","    psi_form_lower = as.numeric(quantile(psi_form, 0.25)),"
"0","    psi_form_upper = as.numeric(quantile(psi_form, 0.75)),"
"0","    "
"0","    psi_delta_median = as.numeric(quantile(psi_delta, 0.5)),"
"0","    psi_delta_lower = as.numeric(quantile(psi_delta, 0.25)),"
"0","    psi_delta_upper = as.numeric(quantile(psi_delta, 0.75))"
"0","  )"
"0","  "
"0","  lapply(vars, function(v)"
"0","    if (is.null(v) |"
"0","        any(is.na(v)))"
"0","      stop(""Some result variable is NULL or NA""))"
"0","  "
"0","  # Then construct your data.frame as usual"
"0","  study_res <- as.data.frame(vars)"
"0","  "
"0","  results_list[[i]] <- study_res"
"0","  "
"0","}"
"0","results_df <- do.call(rbind, results_list)"
"0",""
