"0","psi_mc <- function(data, n_iter = 1e5, assume_phi_zero = FALSE) {"
"0","n_rows <- nrow(data)"
"0",""
"0","map_dfr(seq_len(n_rows), function(i) {"
"0","d <- data[i, ]"
"0",""
"0","alpha <- rbeta(n_iter, d$alpha_a, d$alpha_b)"
"0","beta  <- rbeta(n_iter, d$beta_a,  d$beta_b)"
"0","rho_c <- rbinom(n_iter, d$n,  d$rho_c) / d$n"
"0","psi_c <- rbinom(n_iter, d$sp, d$psi_c) / d$sp"
"0",""
"0","if (assume_phi_zero) {"
"0","  # φ = 0 case (no alternate symptoms)"
"0","  rho <- (rho_c + beta - 1) / (alpha + beta - 1)"
"0","  psi <- 1 - rho_c * (1 - psi_c) / (alpha * rho)"
"0","  psi[is.na(psi) | (psi < 0) | (psi > 1)] <- NA"
"0","} else {"
"0","  # General φ ≠ 0 case"
"0","  phi_c <- rbinom(n_iter, d$sn, d$phi_c) / d$sn"
"0","  psi <- correction(rho_c, psi_c, phi_c, alpha, beta)"
"0","}"
"0",""
"0","tibble("
"0","  study = d$study,"
"0","  psi_l      = quantile(psi, 0.25, na.rm = TRUE),"
"0","  psi_median = quantile(psi, 0.50, na.rm = TRUE),"
"0","  psi_u      = quantile(psi, 0.75, na.rm = TRUE)"
"0",")"
"0",""
"0","})"
"0","}"
"0",""
