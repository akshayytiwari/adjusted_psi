# Interval width of psi
df$rel_width_psi <- (df$psi_u - df$psi_l)/df$psi
# Checking correlation between rel_width_psi and sample size
cor_test <- cor.test(df$n, df$rel_width_psi, method = "spearman")
print(cor_test)
# Scatter plot of psi vs sample size
plt <- ggplot(df, aes(x = n, y = rel_width_psi)) +
# geom_errorbar(aes(ymin = psi_l, ymax = psi_u), color = "black", width = 0.1, size = 0.5, alpha = 0.8) +
geom_point(shape = 21, color = "black", fill = "black", size = s_point-1.5) +
scale_x_continuous(trans = 'log10') +
labs(x = "Sample size", y = "Uncertainty in psi") +
theme_minimal() +
theme(text = element_text(family = "Helvetica"),
axis.text = element_text(size = s_text-2, colour = "black"),
axis.title = element_text(size = s_text-2, colour = "black"),
axis.ticks = element_line(linewidth = width_tick, colour = "black"),
axis.ticks.length = unit(length_tick, "cm"),
panel.border = element_rect(colour = "black", fill = NA,
size = width_border),
legend.position = "none")
plt
plt
# open file
setwd(path)
df_recall <- read.csv("data_recall-period_filled.csv")
path_data <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
df_recall <- read.csv("data_recall.csv")
path_data <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path_data)
df_recall <- read.csv("data_recall.csv")
path_data <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path_data)
df_recall <- read.csv("data_recall.csv")
s_text <- 11
s_title <- 12
s_point <- 5
s_scatter <- 3
width_tick <- 0.6
length_tick <- 0.25  # in cm
width_border <- 0.6
# Scatter plots
my_theme <- theme(text = element_text(family = "Helvetica"),
axis.text = element_text(size = s_text, colour = "black"),
axis.title = element_text(size = s_text, colour = "black"),
axis.ticks = element_line(linewidth = width_tick, colour = "black"),
axis.ticks.length = unit(length_tick-0.05, "cm"),
panel.border = element_rect(colour = "black", fill = NA,
size = width_border),
legend.position = "none")
# Scatter plot
library(ggplot2)
ggplot(df_recall, aes(x = recall_period_calculated)) +
geom_point(aes(y = df$psi), size = 1.5) +
scale_y_continuous(breaks = seq(0, 1, by = 0.25), limits = c(0, 1.03),
expand = c(0, 0)) +
scale_x_continuous(breaks = seq(0, 50, by = 10), limits = c(0, 54),
expand = c(0, 0)) +
theme_minimal() + my_theme
# Correlation
cor.test(df_recall$recall_period_calculated, df$psi, method = "spearman")
# Scatter plot
library(ggplot2)
ggplot(df_recall, aes(x = recall_period_calculated)) +
geom_point(aes(y = df$psi), size = 1.5) +
scale_y_continuous(breaks = seq(0, 1, by = 0.25), limits = c(0, 1.03),
expand = c(0, 0)) +
scale_x_continuous(breaks = seq(0, 50, by = 10), limits = c(0, 54),
expand = c(0, 0)) +
labs(x = "Symptom recall period (weeks)", y = "psi") +
theme_minimal() + my_theme
# Correlation
cor.test(df_recall$recall_period_calculated, df$psi, method = "spearman")
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
# Renaming the column names of the dataset
study_names <- unique(df$article)
study_names <- append(study_names, "Kumar et al.", after = 20)
study_names
colnames(sym_mat) <- c("Symptom", study_names)
colnames(sym_mat)
# sym_mat <- sym_mat %>% filter(Country != "Maldives")
# symptoms <- sym_mat$Country
sym_mat[-1] <- lapply(sym_mat[-1], function(x) ifelse(x %in% c("y", "Y"), 1, 0))
colnames(sym_mat)
# Check for columns that are not all zeros (excluding first)
keep_cols <- apply(sym_mat[, -1], 2, function(x) any(x != 0))
# Rebuild dataframe
sym_mat_filtered <- cbind(sym_mat[, 1, drop = FALSE], sym_mat[, -1][, keep_cols])
names(sym_mat_filtered)[names(sym_mat_filtered) == "Kumar et al..1"] <- "Kumar et al."
sym_list <- sym_mat_filtered[, 1]
sym_mat_filtered <- sym_mat_filtered[-1]
rownames(sym_mat_filtered) <- sym_list
view(sym_mat_filtered)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
# Renaming the column names of the dataset
study_names <- unique(df$article)
study_names <- append(study_names, "Kumar et al.", after = 20)
study_names
colnames(sym_mat) <- c("Symptom", study_names)
colnames(sym_mat)
View(sym_mat)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
View(sym_mat)
df$article
study_names <- unique(df$article)
study_names
study_names <- append(study_names, "Kumar et al.", after = 20)
study_names
colnames(sym_mat) <- c("Symptom", study_names)
colnames(sym_mat)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
# Renaming the column names of the dataset
study_names <- unique(df$article)
study_names <- append(study_names, "Kumar et al.", after = 20)
study_names
View(sym_mat)
colnames(sym_mat)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
# Renaming the column names of the dataset
study_names <- unique(df$article)
study_names
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
View(sym_mat)
# Renaming the column names of the dataset
study_names <- unique(df$article)
study_names
study_names <- append(study_names, "Kumar et al.", after = 20)
study_names
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
sym_mat[-1] <- lapply(sym_mat[-1], function(x) ifelse(x %in% c("y", "Y"), 1, 0))
colnames(sym_mat)
View(sym_mat)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
sym_mat = read.csv('./symptom_matrix.csv', header = TRUE)
# Suppose your dataframe is named df
names(sym_mat)[-1] <- gsub("\\.", "", names(sym_mat)[-1])
colnames(sym_mat)
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
# base R
sym_mat <- read.csv('./symptom_matrix.csv',
header = TRUE,
check.names = FALSE,
stringsAsFactors = FALSE)
sym_mat[-1] <- lapply(sym_mat[-1], function(x) ifelse(x %in% c("y", "Y"), 1, 0))
colnames(sym_mat)
sym_mat_filtered <- sym_mat
sym_list <- sym_mat_filtered[, 1]
sym_mat_filtered <- sym_mat_filtered[-1]
rownames(sym_mat_filtered) <- sym_list
library(plotly)
library(heatmaply)
library(RColorBrewer)
p1 <- heatmaply(sym_mat_filtered, Colv = NA, Rowv = NA,
margins = c(60,50,40,20),
colors = YlOrRd,
hide_colorbar = TRUE,
fontsize_row = 10,
fontsize_col = 10,
grid_color = "black",
grid_size = 0.01,
column_text_angle = 90,
axis_text_color = "black", # make acis text bold
# file = "heatmaply_plot.pdf"
)
p1
p1
path <- "~/ubuntu_research/Research/adjusted_psi/data/final_data"
setwd(path)
# base R
sym_mat <- read.csv('./symptom_matrix.csv',
header = TRUE,
check.names = FALSE,
stringsAsFactors = FALSE)
# Renaming the column names of the dataset
# study_names <- unique(df$article)
#
# study_names <- append(study_names, "Kumar et al.", after = 20)
# study_names
#
# colnames(sym_mat) <- c("Symptom", study_names)
# colnames(sym_mat)
# sym_mat <- sym_mat %>% filter(Country != "Maldives")
# symptoms <- sym_mat$Country
sym_mat[-1] <- lapply(sym_mat[-1], function(x) ifelse(x %in% c("y", "Y"), 1, 0))
colnames(sym_mat)
sym_mat_filtered <- sym_mat
# Rebuild dataframe
# sym_mat_filtered <- cbind(sym_mat[, 1, drop = FALSE], sym_mat[, -1][, keep_cols])
# names(sym_mat_filtered)[names(sym_mat_filtered) == "Kumar et al..1"] <- "Kumar et al."
sym_list <- sym_mat_filtered[, 1]
sym_mat_filtered <- sym_mat_filtered[-1]
rownames(sym_mat_filtered) <- sym_list
setwd(path)
write.csv(sym_mat_filtered, "num_symptoms.csv")
library(plotly)
library(heatmaply)
library(RColorBrewer)
p1 <- heatmaply(sym_mat_filtered, Colv = NA, Rowv = NA,
margins = c(60,50,40,20),
colors = YlOrRd,
hide_colorbar = TRUE,
fontsize_row = 10,
fontsize_col = 10,
grid_color = "black",
grid_size = 0.01,
column_text_angle = 90,
axis_text_color = "black", # make acis text bold
# file = "heatmaply_plot.pdf"
)
p1
p1
p1
library(heatmaply)
library(plotly)
p1 <- heatmaply(
sym_mat_filtered,
Colv = NA, Rowv = NA,
margins = c(60, 50, 40, 20),
colors = YlOrRd,
hide_colorbar = TRUE,
fontsize_row = 10,
fontsize_col = 10,
grid_color = "black",
grid_size = 0.01,
column_text_angle = 90,
axis_text_color = "black"
)
# Increase axis text size and make it bold
p1 <- p1 %>%
layout(
xaxis = list(
titlefont = list(size = 16, color = "black", family = "Arial", bold = TRUE),
tickfont  = list(size = 14, color = "black", family = "Arial", bold = TRUE)
),
yaxis = list(
titlefont = list(size = 16, color = "black", family = "Arial", bold = TRUE),
tickfont  = list(size = 14, color = "black", family = "Arial", bold = TRUE)
)
)
p1
p1
library(heatmaply)
library(plotly)
p1 <- heatmaply(
sym_mat_filtered,
Colv = NA, Rowv = NA,
margins = c(60, 50, 40, 20),
colors = YlOrRd,
hide_colorbar = TRUE,
fontsize_row = 10,
fontsize_col = 10,
grid_color = "black",
grid_size = 0.01,
column_text_angle = 90,
axis_text_color = "black"
)
# Increase axis text size and make it bold
p1 <- p1 %>%
layout(
xaxis = list(
titlefont = list(size = 16, color = "black", family = "Arial", bold = TRUE),
tickfont  = list(size = 14, color = "black", family = "Arial", bold = TRUE)
),
yaxis = list(
titlefont = list(size = 16, color = "black", family = "Arial", bold = TRUE),
tickfont  = list(size = 14, color = "black", family = "Arial", bold = TRUE)
)
)
p1
# Correlation between psi and num_sym
cor <- cor.test(df$num_sym, df$psi, method = "spearman")
# This automatically removes countries with missing values
cor
View(df)
# Correlation between psi and num_sym
cor <- cor.test(df$num_sym, df$psi, method = "spearman")
# This automatically removes countries with missing values
cor
p2 <- ggplot(df, aes(x=num_sym, y=psi)) +
geom_point(size=1.5, colour='black')+
theme_minimal() +  # theme_minimal() +
scale_y_continuous(breaks=seq(0.25,1,by=0.25)) +
scale_x_continuous(breaks=seq(4,16,by=4)) +
# coord_flip() +
theme(text = element_text(family = "Helvetica"),
axis.text = element_text(size = s_text, colour = "black"),
axis.title = element_text(size = s_text, colour = "black"),
axis.ticks = element_line(linewidth = width_tick, colour = "black"),
axis.ticks.length = unit(length_tick, "cm"),
panel.border = element_rect(colour = "black", fill = NA,
size = width_border),
legend.position = "none")
p2
# Correlation between phi_c and num_sym
cor <- cor.test(df$num_sym, df$phi_c, method = "spearman")
# This automatically removes countries with missing values
cor
p3 <- ggplot(df, aes(x=num_sym, y=phi_c)) +
geom_point(size=1.5, colour='black')+
theme_minimal() +  # theme_minimal() +
scale_y_continuous(breaks=seq(0.25,1,by=0.25)) +
scale_x_continuous(breaks=seq(4,16,by=4)) +
# coord_flip() +
theme(text = element_text(family = "Helvetica"),
axis.text = element_text(size = s_text, colour = "black"),
axis.title = element_text(size = s_text, colour = "black"),
axis.ticks = element_line(linewidth = width_tick, colour = "black"),
axis.ticks.length = unit(length_tick, "cm"),
panel.border = element_rect(colour = "black", fill = NA,
size = width_border),
legend.position = "none")
p3
?t.test
# Extracting countries where multiple studies were available
df_multiple <- df %>%
group_by(country) %>%
filter(n() > 1) %>%
ungroup()
# Obtaining variance of psi_c and psi within countries with multiple studies
country_variance <- df_multiple %>%
group_by(country) %>%
summarise(var_c = var(psi_c),
var = var(psi),
var_red = (var(psi_c)-var(psi))*100/var(psi_c))
# Perform a one-tailed paired t-test to test if variance reduction is significant
t_test_result <- t.test(country_variance$var, country_variance$var_c,
paired = TRUE, alternative = "less")
t_test_result
View(df_multiple)
length(unique(df_multiple$country))
View(df)
View(country_variance)
df_m <- df %>%
filter(country == "Germany") %>%
select(alpha)
df_m
df_m <- df %>%
filter(country == "UK") %>%
select(alpha)
df_m
country_variance <- df_multiple %>%
group_by(country) %>%
summarise(var_c = round(var(psi_c), 3),
var = round(var(psi), 3),
var_red = round((var(psi_c)-var(psi))*100/var(psi_c)), 3)
print((var(df$psi_c) - var(df$psi))*100/var(df$psi_c))
df1 <- data.frame(
value = c(df$psi_c, df$psi),
group = rep(c("psi_c", "psi"), times = c(length(df$psi_c), length(df$psi)))
)
view(df1)
levene_test_result <- leveneTest(value ~ group, data = df1)
library(car)
# Perform Levene's test
levene_test_result <- leveneTest(value ~ group, data = df1)
# Display results
print(levene_test_result)
df$mean_median_age
cor <- cor.test(df$mean_median_age, df$psi_c, method = "spearman")
# This automatically removes countries with missing values
cor
cor_psi_c <- cor.test(df$mean_median_age, df$psi_c, method = "spearman")
cor_psi <- cor.test(df$mean_median_age, df$psi, method = "spearman")
cor_psi_c
cor_psi
rm(list = ls())
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(gridExtra)
library(reshape2)
library(ggrepel)
library(readr)
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/01_formalism.R")
source('scripts/04_monte_carlo.R')
s_text <- 15
s_title <- 12
s_point <- 5
s_scatter <- 3
width_tick <- 0.6
length_tick <- 0.25  # in cm
width_border <- 0.6
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
source("scripts/04_monte_carlo.R")
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/04_monte_carlo.R")
df <- df %>%
rowwise() %>%
mutate(mc = list(monte_carlo(n, sp, sn, 100000,
rho_c, psi_c, phi_c,
alpha_a, alpha_b, beta_a, beta_b))) %>%
mutate(psi_l = mc$psi[1], psi = mc$psi[2], psi_u = mc$psi[3],
eta_l = mc$eta[1], eta = mc$eta[2], eta_u = mc$eta[3]) %>%
ungroup()
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/04_monte_carlo.R")
df <- df %>%
rowwise() %>%
mutate(mc = list(monte_carlo(n, sp, sn, 100000,
rho_c, psi_c, phi_c,
alpha_a, alpha_b, beta_a, beta_b))) %>%
mutate(psi_l = mc$psi[1], psi = mc$psi[2], psi_u = mc$psi[3],
eta_l = mc$eta[1], eta = mc$eta[2], eta_u = mc$eta[3]) %>%
ungroup()
setwd(path)
df = read.csv('data/data_main.csv', header = TRUE)
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/04_monte_carlo.R")
df <- df %>%
rowwise() %>%
mutate(mc = list(monte_carlo(n, sp, sn, 100000,
rho_c, psi_c, phi_c,
alpha_a, alpha_b, beta_a, beta_b))) %>%
mutate(psi_l = mc$psi[1], psi = mc$psi[2], psi_u = mc$psi[3],
eta_l = mc$eta[1], eta = mc$eta[2], eta_u = mc$eta[3]) %>%
ungroup()
View(df)
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/04_monte_carlo.R")
df <- df %>%
rowwise() %>%
mutate(mc = list(monte_carlo(n, sp, sn, 100000,
rho_c, psi_c, phi_c,
alpha_a, alpha_b, beta_a, beta_b))) %>%
mutate(psi_l = mc$psi[1], psi = mc$psi[2], psi_u = mc$psi[3],
eta_l = mc$eta[1], eta = mc$eta[2], eta_u = mc$eta[3]) %>%
ungroup()
View(df)
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/04_monte_carlo.R")
df <- df %>%
rowwise() %>%
mutate(mc = list(monte_carlo(n, sp, sn, 100000,
rho_c, psi_c, phi_c,
alpha_a, alpha_b, beta_a, beta_b))) %>%
mutate(psi_l = mc$psi[1], psi = mc$psi[2], psi_u = mc$psi[3],
eta_l = mc$eta[1], eta = mc$eta[2], eta_u = mc$eta[3]) %>%
ungroup()
View(df)
view(round(df$eta))
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(reshape2)
library(ggrepel)
source("../scripts/01_formalism.R")
source("../scripts/04_monte_carlo.R")
source("../scripts/05_plot_distributions.R")
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(reshape2)
library(ggrepel)
source("../scripts/01_formalism.R")
source("../scripts/04_monte_carlo.R")
source("../scripts/05_plot_distributions.R")
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(reshape2)
library(ggrepel)
source("../scripts/01_formalism.R")
source("../scripts/04_monte_carlo.R")
source("../scripts/05_plot_distributions.R")
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(reshape2)
library(ggrepel)
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("../scripts/01_formalism.R")
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
library(reshape2)
library(ggrepel)
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
source("scripts/01_formalism.R")
source("scripts/04_monte_carlo.R")
source("scripts/05_plot_distributions.R")
#source("scripts/06_correlation_analysis.R")
df <- read.csv("data/data_main.csv")
curwd
getwd()
df <- read.csv("/data/data_main.csv")
df <- read.csv("data/data_main.csv")
path <- "~/ubuntu_research/Research/adjusted_psi/asymptomatic_prevalence"
setwd(path)
df <- read.csv("data/data_main.csv")
install.packages("here")
